url = "/api/v1/book/:slug"
title = "Book Detail Api"

[bookDetail]
slug = "{{ :slug }}"
==

{% set chapters = collect() %}
{% for chapter in book.chapters %}
    {% set pages = collect() %}
    {% for page in chapter.pages %}
        {% do pages.push(page.path) %}
    {% endfor %}
    {% do chapters.push({
        id: chapter.id,
        number: chapter.number,
        slug: chapter.slug,
        status: chapter.status,
        title: chapter.title,
        sub_title: chapter.description,
        pages_count: chapter.pages_count,
        pages: pages,
    }) %}
{% endfor %}

{% set categories = collect() %}
{% for cat in book.categories %}
    {% do categories.push({
        id: cat.id,
        name: cat.name,
        slug: cat.slug,
        api_url: 'api/v1/books'|page({ listBy: 'category', slug: cat.slug}),
    }) %}
{% endfor %}

{% set tags = collect() %}
{% for tag in book.tags %}
    {% do tags.push({
        id: tag.id,
        name: tag.name,
        slug: tag.slug,
        api_url: 'api/v1/books'|page({ listBy: 'tag', slug: tag.slug}),
    }) %}
{% endfor %}

{% set comments = collect() %}
{% for comment in book.comments %}
    {% if comment.is_published  %}
    {% else %}
        {% do comments.push({
            id: comment.id,
            name: comment.name,
            email: comment.email,
            comment: comment.comment,
            created_at: comment.created_at,
        }) %}
    {% endif %}
{% endfor %}


{% set recommendedBooks = collect() %}
{% for recommended in relatedBooks %}
    {% do recommendedBooks.push({
        id: recommended.id,
        title: recommended.title,
        slug: recommended.slug,
        desc: recommended.description,
        cover: recommended.cover.path,
        author: recommended.author.name,
        author_id: recommended.author.id,
        author_slug: recommended.author.slug,
        author_api_url: 'api/v1/books'|page({ listBy: 'author', slug: recommended.author.slug}),
        artist: recommended.artist.name,
        artist_id: recommended.artist.id,
        artist_slug: recommended.artist.slug,
        artist_api_url: 'api/v1/books'|page({ listBy: 'artist', slug: recommended.artist.slug}),
        categories: categories,
        tags: tags,
    }) %}
{% endfor %}

{% do response({
    id: book.id,
    title: book.title,
    slug: book.slug,
    desc: book.description,
    rating: book.rating,
    status: book.status,
    cover: book.cover.path,
    author: book.author.name,
    author_id: book.author.id,
    author_slug: book.author.slug,
    artist: book.artist.name,
    artist_id: book.artist.id,
    artist_slug: book.artist.slug,
    chapters: chapters,
    categories: categories,
    tags: tags,
    comments: comments,
    recommended_books: recommendedBooks,
}) %}

{#
 {
    id: 1,
    title: 'Dark Knights of Steel (2021)',
    desc: 'ကျူးကျော်သူသည် ....',
    rating: 3.5,
    status: 'Completed',
    image: 'https://www.dccomics.com/image.jpg',
    aurthor: 'Geoff Johns',
    artist: 'Gary Frank',
    chapters: [
      {
        id: 1,
        title: 'Chapter 1',
        sub_title: 'First Contact',
        status: false,
        cover_image: 'https://www.dccomics.com/image.jpg',
        image: [
          'https://www.dccomics.com/image.jpg',
          'https://www.dccomics.com/image.jpg',
        ],
      },
      {
        id: 2,
        title: 'Chapter 2',
        sub_title: 'The First Encounter',
        status: 'New',
        cover_image: 'https://www.dccomics.com/image.jpg',
        image: [
          'https://www.dccomics.com/image.jpg',
          'https://www.dccomics.com/image.jpg',
        ],
      },
      {
        id: 3,
        title: 'Chapter 3',
        sub_title: 'Greetings',
        status: 'New',
        cover_image: 'https://www.dccomics.com/image.jpg',
        image: [
          'https://www.dccomics.com/image.jpg',
          'https://www.dccomics.com/image.jpg',
        ],
      },
    ]
  }
#}